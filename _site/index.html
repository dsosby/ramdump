<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
		<head>
		<meta content="en-au" http-equiv="Content-Language" />
		<meta content="text/html; charset=utf-8" http-equiv="Content-Type" />
		<link href="/rss.xml" type="application/rss+xml" rel="alternate" title="Blog Feed" />
		<link href="/atom.xml" type="application/atom+xml" rel="alternate" title="Blog Feed" />
		<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
		<title>SiteName</title>
		<link rel="stylesheet" type="text/css" href="/css/style.css" />
		<link rel="stylesheet" href="//cdn.jsdelivr.net/highlight.js/8.4/styles/default.min.css">
		<link rel="shortcut icon" href="/img/favicon.ico" />
	</head>

	<body>
		<div id="container">
			<div id="side">
				<a href="/" id="home" title="home" alt="home"><img src="/img/logo.png" alt="Site Name" /></a>
				<div id="hometext"><a href="/" >Site Name</a></div>
				<div class="section">
					<ul>
						<li><a href="/about.html">about</a></li>
						<li><a href="/rss.xml"><img src="/img/25.png" /> feed</a></li>
					</ul>
				</div>
			</div>
			<div id="content">
				<ul class="posts">
    
        <li>
            <div class="idea">
                
                    <h1><a href="/ChickenScheme/CouchDB/2012/10/24/chicken-scheme-and-couchdb.html">Chicken Scheme and CouchDB</a></h1>
                    <div class="postdate">24 October, 2012
                        <ul>
                        
                        </ul>
                    </div>
                    <h1>But Why?</h1>
I've recently been playing around with <a href="http://call-cc.org/" target="_blank">Chicken Scheme</a>, leaving poor Clojure all high and dry (minus some visits to the newly started <a href="http://www.meetup.com/DFW-Clojure/" target="_blank">DFW-Clojure User Group</a>). After building a service in C at work, I've caught the high-performance bug and Clojure hasn't particularly been helpful in that regard. I've also found Chicken Scheme to be very simple with a more straightforward syntax than Clojure. I'll still use Clojure, and am using it on a web-app side-project, but client side I'm really digging Chicken.
<p>I've also been using MongoDB, but (OMG!) there's no driver currently for MongoDB in Chicken Scheme. Until I have the chops to write my own version, I decided I might as well learn a similar DB: enter <a href="http://couchdb.apache.org/" target="_blank">Couch</a>. In my naive view, it's very similar to Mongo - it's a document-oriented database with JSON (or <a href="http://bsonspec.org/" target="_blank">variation thereof</a>) as its representative data structure. Even cooler, it's already been ported to <a href="http://openbbnews.wordpress.com/2012/01/13/couchdb-playbook/" target="_blank">BlackBerry 10</a>. This gives me some really good ideas for new projects.</p>
<h1>The Setup</h1>
I'm currently running <a href="http://linuxmint.com/" target="_blank">Linux Mint</a>, a "fork" of Ubuntu, so this setup guide follows what was necessary for me to get up and going with Chicken Scheme and CouchDB.
<h3>Chicken Scheme</h3>
There are two options. The easy way:
<pre>sudo apt-get install chicken-bin.</pre>
This installs everything for you with no issue, however it's an older version (as seems to be a common issue with the Ubuntu repositories). At the time of writing it's at 4.7.0. You can also install Chicken by compiling from source. Download the tarball from <a href="http://code.call-cc.org/releases/4.8.0/" target="_blank">call-cc.org</a>, untar, and follow the INSTALL instructions. Easy!
<h3>CouchDB Egg</h3>
Chicken Scheme has an extension system which packages and distributes "<a href="http://wiki.call-cc.org/eggs" target="_blank">eggs</a>." An egg consists of Scheme sources plus some meta information such as build scripts and egg dependencies. You can install an egg using the chicken-install utility that comes with Chicken.
<p>[code language=&quot;Bash&quot;]
chicken-install -sudo couchdb
[/code]</p>
<p>This will download the <a href="http://wiki.call-cc.org/eggref/4/couchdb" target="_blank">couchdb egg</a> along with all eggs in the dependency tree. The utility then begins compiling and installing all eggs along the way. If you don't do a lot of development, chances are likely that you will run into system dependencies that are unmet. Chicken Scheme compiles to C, and as such many eggs have dependencies on C libraries.</p>
<p>The one I hit with couchdb in particular was openssl. These system lib dependencies can be a little tricky to identify. Two tips:</p>
<ul>
    <li>See which egg is failing, then find it in the egg index and look through it's notes which <em>usually</em> indicate dependencies</li>
    <li>Read the error message and decipher from there.</li>
</ul>
For example, my first attempt at installing the couchdb egg failed due to missing openssl header files. The install utility was attempting to compile the openssl egg, which was a dependency of the http-client egg, which is a dependency of the couchdb egg.
<p>A few searches for openssl and I satisfied the dependency with the following command:</p>
<p>[code language=&quot;Bash&quot;]
sudo apt-get install libssl-dev
[/code]</p>
<p>With that successfully in place, another call to install the couchdb egg succeeded.</p>
<h1>Playing Around</h1>
I didn't have time to compile and install a CouchDB server on my machine, so <em>to the cloud</em> I went. I signed up for an account at <a href="https://cloudant.com/" target="_blank">cloudant.com</a> which provides a free-for-small-databases CouchDB compatible database. After signing up, I imported the example database aptly named "crud" and began toying around.
<p>Booting up csi, the Chicken Scheme interpreter, I called <code>(use couchdb)</code> and set out to play. The first hurdle: making a connection. The current documentation says to use something along the lines of <code>(define couch (make-connection &quot;databasename&quot; &quot;http://localhost:123&quot;))</code>.</p>
<p>That failed miserably.</p>
<p>No matter what I tried, the command <code>(get-server-info couch)</code> would fail with a connection refused. <code>(connection-uri couch)</code> showed that the URI struct was still pointing at localhost. Luckily, the <a href="http://code.call-cc.org/svn/chicken-eggs/release/4/" target="_blank">source for Chicken eggs</a> are available, even for CouchDB. The make-connection function is created by the <code>(defstruct connection ...)</code> expression. I noticed that the server attribute of connection struct is a <code>uri-reference</code>, <em>not</em> a string. Reading through the defstruct docs I figured out the following worked - woot.</p>
<p>[code]
(import uri-common)
(define cloudant-url server: (uri-reference &quot;https://username:password@username.cloudant.com&quot;))
(define cloudant (make-connection server: cloudant-url database: &quot;crud&quot;))
(get-server-info cloudant)
[/code]</p>
<p>This returns JSON data in Scheme structure:</p>
<p>[code]
#((&quot;couchdb&quot; . &quot;Welcome&quot;)
(&quot;version&quot; . &quot;1.0.2&quot;)
(&quot;cloudant_build&quot; . &quot;768&quot;))
[/code]</p>
<p>Since I'm new to Scheme, getting the data out was a bit odd, and I'm sure completely inefficient.</p>
<p>[code]
(define server-info (vector-&gt;list (get-server-info cloudant)))
(alist-ref &quot;version&quot; server-info equal?)
[/code]</p>
<p>That about sums it up. Hopefully I figure more stuff out and post some updates. Feel free to comment if I'm reading the JSON structure in a completely asinine way. The vector-&gt;list doesn't seem right.</p>
<h1>Update</h1>
The couchdb egg documentation has been updated to cover most of this. I've also noticed a generally handy function that is exported by the couchdb module, json-ref, that makes it simple to grab top-level JSON items like "version" above.
<p>[code]
(define server-version (json-ref 'version (get-server-info cloudant)))
[/code]</p>
                    <br />
                    <a href="/ChickenScheme/CouchDB/2012/10/24/chicken-scheme-and-couchdb.html#disqus_thread">Comments</a>
                
            </div>
        </li>
    
        <li>
            <div class="idea">
                
                    <h2><a class="postlink" href="/Clojure/ClojureScript/2012/09/18/clojurescript-gotchas-tips.html">ClojureScript Gotchas & Tips</a></h2>
                    <div class="postdate">18 September, 2012
                        <ul>
                        
                        </ul>
                    </div>
                    <p>I've been playing a lot lately with ClojureScript, especially with regards to mobile development (more on that to come later). Clojure has never been known for great error messages, and ClojureScript is probably even worse in that regard.</p>
<p>Included below are a list of things that gave me a rough time. Some are pretty simple, but needless to say they got me. Hopefully they won't get you.</p>
<h1>Gotchas</h1>
<h3>namespaces etc</h3>
The ns function is very special in ClojureScript when compared to Clojure. I won't go over all the differences, those have been covered, but I'll highlight a few things quickly: only one namespace per file; use requires only and require requires as; REPL requires load-namespace instead of ns call; invalid require statements don't give compile errors.
<p>A big one that got me is requiring/using the Google Closure libs and classes. When you require them in your namespace, the ClojureScript compiler just outputs goog.require(&quot;goog.foobar&quot;). The :as makes no difference here. When you refer to the functions/objects, you have to use the fully qualified name, e.g. (goog.foobar/baz 42).</p>
<p>To sum that annoying issue up, you have to both require and use the fully-qualified name.</p>
<h3>Interop With JS Objects</h3>
Sometimes you just have to fall back. Use the js* function to create some straight-up JavaScript:
<pre>((js* "alert") "Hello")</pre>
There will also come a time when you have to create an object to interop with a JavaScript library. It would be nice if ClojureScript maps/lists could be output as an object, but that may just be wishful thinking. In other words, you'll have to copy and paste one of the dozen or so implementations into your code.
<p>You can also use the goog.object package for help which is wrapped by several CLJS functions, the primary one being js-obj which takes arguments and simply applies them to goog.object/create.</p>
<p>Example:</p>
<pre>(js-keys (js-obj "name" "Ben Franklin" "age" 88 "height" 60))</pre>
<h3>Arity With Functions</h3>
When you define a function using defn, it creates a JavaScript function in the background. JavaScript functions do not enforce arity. This means you can do something like this without any failure, only unexpected results.
<pre>(defn tip-cows [])
(tip-cows 1 "zebra")</pre>
<h3>The Compiler Doesn't Care</h3>
Don't expect the compiler to help you out chasing and picking out errors. The compiler only ensures the code can be read and checks for a few minor things (like :require has :as, etc). The vast majority of errors will be found at runtime. You'll have to change your mindset from compiled language to interpreted language.
<h1>Tips</h1>
<a href="http://himera.herokuapp.com" target="_blank">Himera ClojureScript REPL</a> - An online REPL. Very useful! Don't miss the Summary page.
<p>Don't expect (= :ClojureScript :Clojure). They are different.</p>
<p>Surf the <a href="https://github.com/clojure/clojurescript/blob/master/src/cljs/cljs/core.cljs" target="_blank">source</a>!</p>
<p>When you get a &quot;call undefined&quot; error, you most likely forgot your require, misspelled it, or similar.</p>
<p>When you get an error, or something goes bad, load up the JavaScript console and play around. It obviously helps to know JavaScript to some extent here. For example, if you get an undefined error in something like:</p>
<pre>goog.foobar.baz.call(null, helloworld.core.mydef);</pre>
You could use the console to probe and find the culprit, e.g. type
<pre>goog;
goog.foobar;
goog.foobar.baz;</pre>
Keep probing the environment to see what is not as is expected.
                    <a href="/Clojure/ClojureScript/2012/09/18/clojurescript-gotchas-tips.html#disqus_thread">Comments</a>
                
            </div>
        </li>
    
        <li>
            <div class="idea">
                
                    <h2><a class="postlink" href="/2011/12/27/a-human-being-should-be-a.html">A human being...</a></h2>
                    <div class="postdate">27 December, 2011
                        <ul>
                        
                            <li><a href="/tag/miscellaneous">miscellaneous</a></li>
                        
                            <li><a href="/tag/quote">quote</a></li>
                        
                        </ul>
                    </div>
                    <blockquote>A human being should be able to change a diaper, plan an invasion, butcher a hog, conn a ship, design a building, write a sonnet, balance accounts, build a wall, set a bone, comfort the dying, take orders, give orders, cooperate, act alone, solve equations, analyze a new problem, pitch manure, program a computer, cook a tasty meal, fight efficiently, die gallantly. Specialization is for insects. - Robert A. Heinlein</blockquote>
<p>I love this quote. I've not read the book, but I now plan on it.</p><ol><li><del>Change a diaper</del></li><li>Plan an invasian</li><li>Butcher a hog</li><li>Conn a ship</li><li><del>Design a building</del></li><li><del>Write a sonnet</del></li><li><del>Balance accounts</del></li><li><del>Build a wall</del></li><li>Set a bone</li><li><del>Comfort the dying</del></li><li><del>Take orders</del></li><li><del>Give orders</del></li><li><del>Cooperate</del></li><li><del>Act alone</del></li><li><del>Solve equations</del></li><li><del>Analyze a new problem</del></li><li><del>Pitch manure</del></li><li><del>Program a computer</del></li><li><del>Cook a tasty meal</del></li><li><del>Fight efficiently</del></li><li>Die gallantly</li></ol><p>I'm pretty far along on the list, though I think I'll hold off on completing #21 for as long as possible.</p>
                    <a href="/2011/12/27/a-human-being-should-be-a.html#disqus_thread">Comments</a>
                
            </div>
        </li>
    
        <li>
            <div class="idea">
                
                    <h2><a class="postlink" href="/2011/10/11/a-quick-fix.html">A Quick Fix</a></h2>
                    <div class="postdate">11 October, 2011
                        <ul>
                        
                        </ul>
                    </div>
                    <p>First off, I love using the keyboard. When I'm forced to use the mouse, my heart cries just a bit. The mouse is an excellent and convenient tool, there is no doubt, but if it's an action I will perform multiple times, I want to automate it with the quick press of a key (or two).</p>
<p>After looking at XMonad a bit, I wasn't quite ready to give up my comfortable XFCE-provided window manager but did want to resize my windows in a way that was convenient. A bit of google-fu led me to <a href="http://tomas.styblo.name/wmctrl/" target="_blank">wmctrl</a> and <a href="https://github.com/soulfx/stiler" target="_blank">stiler.py</a>. Once installed, I setup a new Runner command in Launchy, a simple call to stiler.py with a corresponding argument, and voila, a new tiling manager. It's a bit on the slow side, but it's simple to install and use and fits into my current workflow without much thinking.</p>
<p>As a side note, I think I'm going to use ramdump.com as more of a Tumblog-type site versus a full-on blog. My notebook is full of ideas, but the perfectionist in me doesn't like putting out the smaller posts that my time allows. I'll fight that feeling and use this as my brain dump that I envisioned to begin with.</p>
                    <a href="/2011/10/11/a-quick-fix.html#disqus_thread">Comments</a>
                
            </div>
        </li>
    
        <li>
            <div class="idea">
                
                    <h2><a class="postlink" href="/Python/2011/08/04/obsidian-theme-for-idle.html">Obsidian Theme for IDLE</a></h2>
                    <div class="postdate"> 4 August, 2011
                        <ul>
                        
                        </ul>
                    </div>
                    <p>I attempt to use dark backgrounds in all of my editors. I find it much <a href="http://www.thebestpageintheuniverse.net/c.cgi?u=faq">easier on my eyes</a> when I'm staring at code all day long or hacking on something early in the morning. I generally use something close to my favorite color scheme on Notepad++, Obsidian, which I  believe is based on Obsidian Coast in KDE.</p>
<p>With that said, Python's IDLE application is harshly bright compared to my normal editors. After a quick Google search I found only a few themes available for IDLE, so I created IDLE highlighting settings that mimic my favorite color scheme. Here is the first draft for all to enjoy. You can also find the latest updates in <a href="https://gist.github.com/1122904">this</a> Gist repo. Installation is easy: just copy and paste these settings into your .idlerc\config-highlight.cfg file in your home directory (creating as necessary), then choose it in your Highlighting settings in IDLE by selecting &quot;Use Custom Theme&quot; and &quot;Obsidian&quot; from the dropdown.</p>
<p><a href="http://ramdump.files.wordpress.com/2011/08/idle_obsidian.png"><img src="{{ site-url }}/img/idle_obsidian.png" alt="Screenshot of Obsidian for IDLE" title="IDLE Obsidian"></a></p>
<h3>The Code</h3>
<pre><code>definition-foreground = #678CB1
error-foreground = #FF0000
string-background = #293134
keyword-foreground = #93C763
normal-foreground = #E0E2E4
comment-background = #293134
hit-foreground = #E0E2E4
builtin-background = #293134
stdout-foreground = #678CB1
cursor-foreground = #E0E2E4
break-background = #293134
comment-foreground = #66747B
hilite-background = #2F393C
hilite-foreground = #E0E2E4
definition-background = #293134
stderr-background = #293134
hit-background = #000000
console-foreground = #E0E2E4
normal-background = #293134
builtin-foreground = #E0E2E4
stdout-background = #293134
console-background = #293134
stderr-foreground = #FB0000
keyword-background = #293134
string-foreground = #EC7600
break-foreground = #E0E2E4
error-background = #293134
</code></pre>
                    <a href="/Python/2011/08/04/obsidian-theme-for-idle.html#disqus_thread">Comments</a>
                
            </div>
        </li>
    
</ul>
<h3>OLDER</h3>
<ul class="postArchive">

    <li>
        <span class="olderpostdate"> 15 Jul </span> <a class="postlink" href="/Clojure/2011/07/15/project-euler-problem-1-in-clojure.html">Project Euler Problem 1 in Clojure</a>
    </li>

    <li>
        <span class="olderpostdate"> 24 Jun </span> <a class="postlink" href="/Coding/2011/06/24/on-descriptive-conditionals.html">On Descriptive Conditionals</a>
    </li>

    <li>
        <span class="olderpostdate"> 16 Jun </span> <a class="postlink" href="/2011/06/16/the-birth-of-ram-dump.html">The Birth of RAM Dump</a>
    </li>

</ul>
<script type="text/javascript">
//<![CDATA[
(function() {
    var links = document.getElementsByTagName('a');
    var query = '?';
    for(var i = 0; i < links.length; i++) {
    if(links[i].href.indexOf('#disqus_thread') >= 0) {
        query += 'url' + i + '=' + encodeURIComponent(links[i].href) + '&';
    }
    }
    document.write('<script charset="utf-8" type="text/javascript" src="http://disqus.com/forums/DISQUS_NAME/get_num_replies.js' + query + '"></' + 'script>');
})();
//]]>
</script>
			</div>
		</div>
		<script src="//cdn.jsdelivr.net/highlight.js/8.4/highlight.min.js"></script>
		<script>hljs.initHighlightingOnLoad();</script>
	</body>
</html>